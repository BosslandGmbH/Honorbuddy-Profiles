<HBProfile xsi:noNamespaceSchemaLocation="../Questing Profile Pack/Schemas/EchoSchema.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

	<MinDurability>-1</MinDurability>
	<MinFreeBagSlots>-1</MinFreeBagSlots>

	<!-- Original contribution by EchoTiger -->
	<Name>90-100 Autoloader ($Rev: 5593 $)</Name>

	<QuestOrder>
		<If Condition="Me.IsAlliance" >
			<Code File="LoadProfile" ProfileName="..\1-110 Autoloader.xml" />
		</If>

		<If Condition="Me.Class == WoWClass.DemonHunter &amp;&amp; !IsQuestCompleted(41002)" >
			<Code File="LoadProfile" ProfileName="Starters/Demon Hunter.xml" RememberProfile="true />
		</If>


		<Code File="RunCode" Type="Definition"><![CDATA[
			bool NeedsQuest(params uint[] questIds)
			{
				foreach (var questId in questIds)
				{
					if (!HasQuest(questId) && !IsQuestCompleted(questId)) return true;
				}
				return false;
			}
			bool LoremasterCheckpointCheck(float levelToCheck, int achievementId = 0, int achievementIndex = 0)
			{
				if (Me.LevelFraction < levelToCheck) return true;
				if (achievementId == 0) return false;
				return (Styx.Helpers.CharacterSettings.Instance.IgnoreCheckpoints && !IsAchievementCompleted(achievementId, achievementIndex));
			}
			bool HasArrivedDraenor()
			{
				if (StyxWoW.Me.CurrentMap.ExpansionId == 5) return true;
				return false;
			}
			bool InPriorityLocationDraenor()
			{	
				if (StyxWoW.Me.ZoneId == 6554 || StyxWoW.Me.ZoneId == 6141) return true; // Horde Shrine
				if (StyxWoW.Me.ZoneId == 1637) return true; // Orgrimmar
				if (StyxWoW.Me.ZoneId == 4395) return true; // Dalaran, portal to Orgrimmar.
				return false;
			}

			bool HearthIsPriorityLocationDraenor()
			{
				if (StyxWoW.Me.HearthstoneAreaId == 6519) return true; // Horde Shrine
				if (Styx.WoWInternals.DBC.AreaTable.FromId(StyxWoW.Me.HearthstoneAreaId).MapId == 1) return true; // Orgrimmar
				if (StyxWoW.Me.HearthstoneAreaId == 4395 || StyxWoW.Me.HearthstoneAreaId == 4560) return true; // Dalaran, portal to Orgrimmar/Stormwind.
				if (Styx.WoWInternals.DBC.AreaTable.FromId(StyxWoW.Me.HearthstoneAreaId).MapId == 1116) return true; // Draenor MapId1?
				if (Styx.WoWInternals.DBC.AreaTable.FromId(StyxWoW.Me.HearthstoneAreaId).MapId == 1331) return true; // Draenor MapId2
				return false;
			}
			bool HearthIsReadyDraenor()
			{
				if (HasItem(64488) && !WoWSpell.FromId(94719).Cooldown) return true; // Innkeeper Daughter
				if (HasItem(6948) && !WoWSpell.FromId(8690).Cooldown) return true; // Hearthstone
				if (SpellManager.CanCast(556)) return true; // Astral Recall
				return false;
			}
			bool HasHearthDraenor()
			{
				if (HasItem(64488)) return true; // Innkeeper Daughter
				if (HasItem(6948)) return true; // Hearthstone
				if (SpellManager.CanCast(556)) return true; // Astral Recall
				return false;
			}
			bool CastingInterruptedDraenor()
			{
				if (StyxWoW.Me.Combat || !Me.IsCasting) return true;
				return false;
			}
			void DraenorLog(System.Windows.Media.Color color, string message)
			{
				Bots.Professionbuddy.PBLog.Log(System.Windows.Media.Colors.DeepSkyBlue, "[Azyul Navigator]: ", color, $"{message}");
			}
			]]>
		</Code>

		<If Condition="!HasArrivedDraenor() &amp;&amp; LoremasterCheckpointCheck(98, 9923)" >
			<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;Going to Draenor!&quot;);" />

			<If Condition="HasItem(110560)" >
				<If Condition="Me.BagItems.FirstOrDefault(h => h.Entry == 110560).CooldownTimeLeft.TotalMilliseconds &gt; 120000" >
					<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;Garrison Hearth is on cooldown!  Traveling to Draenor manually...&quot;);" />
				</If>
				<If Condition="Me.BagItems.FirstOrDefault(h => h.Entry == 110560).CooldownTimeLeft.TotalMilliseconds &lt;= 120000 &amp;&amp; Me.BagItems.FirstOrDefault(h => h.Entry == 110560).CooldownTimeLeft.TotalMilliseconds &gt; 0" >
					<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;Garrison Hearth is on cooldown! Waiting until it's off...&quot;);" />
					<Code File="WaitTimer" WaitTime="130000" TerminateWhen="Me.BagItems.FirstOrDefault(h => h.Entry == 110560).CooldownTimeLeft.TotalMilliseconds == 0" />
				</If>
				<If Condition="Me.BagItems.FirstOrDefault(h => h.Entry == 110560).CooldownTimeLeft.TotalMilliseconds == 0" >
					<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;Using our Garrison Hearthstone to reach Draenor!&quot;);" />
					<Code File="ForcedDismount" />
					<While Condition="!(Me.ZoneId == 7078 || Me.ZoneId == 7004)" >
						<Code File="Misc\RunLua" Lua="UseItemByName(110560);" WaitTime="500" />
						<Code File="WaitTimer" WaitTime="50000" TerminateWhen="!(Me.ZoneId == 7078 || Me.ZoneId == 7004) || Me.Combat || !Me.IsCasting" />
					</While>
				</If>
			</If>

			<If Condition="NeedsQuest(34398) || Me.ZoneId != 4" >
				<!-- /// Mage Logic /// -->
				<If Condition="Me.ZoneId != 1637 &amp;&amp; SpellManager.CanCast(3567)" > <!-- Checks if we're a mage and spell is fully learnt+castable -->
					<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;We're a Mage! Teleporting to Orgrimmar.&quot;);" />
					<Code File="ForcedDismount" />
					<While Condition="Me.ZoneId != 1637" >
						<Code File="Misc\RunLua" Lua="CastSpellByID(3567);" WaitTime="500" />
						<Code File="WaitTimer" WaitTime="50000" TerminateWhen="Me.ZoneId == 1637 || Me.Combat || !Me.IsCasting" />
					</While>
				</If>
				<!-- /// Item Teleportation Logic.   Teleport to area that has portals (Shrine/etc) or teleport to destination /// -->
				<If Condition="!HasArrivedDraenor() &amp;&amp; HearthIsPriorityLocationDraenor() &amp;&amp; !InPriorityLocationDraenor() &amp;&amp; HasHearthDraenor()" >
					<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;Hearthing would be faster to reach our destination, attempting to Hearth!&quot;);" />
					<Code File="ForcedDismount" />
					<While Condition="!(HasArrivedDraenor() || InPriorityLocationDraenor())" >
						<Code File="RunCode" Code="await Coroutine.Wait(1800000, () => HearthIsReadyDraenor() || InPriorityLocationDraenor());" />
						<Code File="Misc\RunLua" Lua="UseItemByName(6948); UseItemByName(64488); CastSpellByID(556);" WaitTime="500" />
						<Code File="WaitTimer" WaitTime="50000" TerminateWhen="HasArrivedDraenor() || InPriorityLocationDraenor() || CastingInterruptedDraenor()" />
					</While>
				</If>
				<!-- /// Generic Logic /// -->
				<If Condition="Me.ZoneId == 6455 || Me.ZoneId == 3430 || Me.ZoneId == 3487 || Me.ZoneId == 3433" > <!-- Sunstrider Isle, Eversong Woods, Silvermoon City, Ghostlands -->
					<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;We're in northen Eastern Kingdoms.  Using the Orb of Translocation to enter Undercity.&quot;);" />
					<MoveTo DestName="Inner Sanctum" X="10039.12" Y="-7000.733" Z="61.95295" />
					<While Condition="Me.ZoneId != 85" >
						<Code File="InteractWith" MobId="184502" X="10032.36" Y="-7000.288" Z="61.30979" WaitTime="2500" />
						<Code File="WaitTimer" WaitTime="50000" TerminateWhen="Me.ZoneId == 85" />
					</While>
				</If>
				<If Condition="Me.MapId == 571" > <!-- Northrend -->
					<If Condition="Me.Y &gt;= 3000 &amp;&amp; Me.MapId == 571" > <!-- Western Northrend, Warsong Hold to Orgrimmar -->
						<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;We're in Western Northrend, using the Warsong Hold zeppelin to Orgrimmar.&quot;);" />
						<Code File="FlyTo" X="2946.323" Y="6069.065" Z="147.4432" />
						<DisableBehavior Name="FlightPath" />
						<Code File="MyCTM" X="2829.086" Y="6176.118" Z="128.0574" />
						<Code File="WaitTimer" WaitTime="850" /> <!-- Consider lag and CTM tolerance. -->
						<Code File="ForcedDismount" />
						<Code File="UseTransport" TransportId="186238"
							WaitAtX="2837.035" WaitAtY="6185.063" WaitAtZ="121.9975"
							TransportStartX="2837.908" TransportStartY="6187.443" TransportStartZ="140.1648"
							StandOnX="2844.346" StandOnY="6191.38" StandOnZ="122.3167"					  
							TransportEndX="1775.066" TransportEndY="-4299.745" TransportEndZ="151.0326"
							GetOffX="1761.337" GetOffY="-4281.487" GetOffZ="133.1072"
						/>
						<EnableBehavior Name="FlightPath" />
					</If>
					<If Condition="Me.Y &lt; 3000 &amp;&amp; Me.Y &gt; -2200 &amp;&amp; Me.MapId == 571" > <!-- Middle Northrend, Dalaran to Orgrimmar -->
						<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;We're in Northrend, using the Dalaran portal to Orgrimmar.&quot;);" />
						<MoveTo Nav="Fly" X="5923.893" Y="589.9543" Z="639.8708" />
						<While Condition="Me.MapId != 1" >
							<Code File="InteractWith" MobId="191009" X="5925.874" Y="593.1875" Z="640.5933" TerminateWhen="Me.MapId == 1" />
							<Code File="WaitTimer" WaitTime="50000" TerminateWhen="Me.MapId == 1 || Me.Combat" />
						</While>
					</If>
					<If Condition="Me.Y &lt;= -2200 &amp;&amp; Me.MapId == 571" > <!-- Eastern Northrend, Vengeance Landing to Thunder Bluff -->
						<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;We're in Eastern Northrend, using the Vengeance Landing zeppelin to Undercity.&quot;);" />
						<MoveTo Nav="Fly" X="1974.872" Y="-6098.991" Z="67.15174" />
						<DisableBehavior Name="FlightPath" />
						<Code File="UseTransport" TransportId="181689"
							WaitAtX="1976.73" WaitAtY="-6095.377" WaitAtZ="67.15933"
							TransportStartX="1989.353" TransportStartY="-6082.776" TransportStartZ="85.59646"
							StandOnX="1982.445" StandOnY="-6091.406" StandOnZ="67.6969"
							TransportEndX="2056.493" TransportEndY="381.6347" TransportEndZ="100.362"
							GetOffX="2061.253" GetOffY="360.2228" GetOffZ="82.48778"
						/>
						<EnableBehavior Name="FlightPath" />
					</If>
				</If>
				<If Condition="Me.ZoneId == 4080" > <!-- Isle of Quel'Danas -->
					<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;We're in Isle of Quel'Danas, using the Flight Master to Undercity.&quot;);" />
					<MoveTo DestName="Ohura, the flight master." X="13009.74" Y="-6910.024" Z="9.584676" />
					<Code File="InteractWith" MobId="26560" X="13012.39" Y="-6911.189" Z="9.586156" WaitTime="850" />
					<Code File="Hooks\DoWhen" ActivityName="LandAndHearth" UseWhen="Me.BagItems.FirstOrDefault(h => h.Entry == 110560).CooldownTimeLeft.TotalMilliseconds == 0" >
						<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;Aborting flight since our Garrison Hearth is off cooldown..&quot;);" />
						<Code File="Misc\RunLua" Lua="MainMenuBarVehicleLeaveButton:Click();" WaitTime="1000" />
						<Code File="WaitTimer" WaitTime="600000" TerminateWhen="!Me.OnTaxi" />
						<While Condition="Me.MapId != 1331" >
							<Code File="Misc\RunLua" Lua="UseItemByName(110560);" WaitTime="500" />
							<Code File="WaitTimer" WaitTime="50000" TerminateWhen="Me.MapId == 1331 || Me.Combat || !Me.IsCasting" />
						</While>
						<Code File="Hooks\DoWhen" ActivityName="LandAndHearth" Command="Remove" />
					</Code>
					<Code File="Misc\RunLua" Lua="TaxiButton2:Click();" WaitTime="1000" />
				</If>
				<If Condition="Me.MapId == 530" > <!-- Outlands -->
					<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;We're in Outlands, using the Shattrath portal to Orgrimmar.&quot;);" />
					<MoveTo Nav="Fly" X="-1898.129" Y="5395.677" Z="-12.42727" />
					<While Condition="Me.MapId != 1" >
						<Code File="InteractWith" MobId="183323" X="-1899.45" Y="5393.01" Z="-12.42832" TerminateWhen="Me.MapId == 1" />
						<Code File="WaitTimer" WaitTime="50000" TerminateWhen="Me.MapId == 1 || Me.Combat" />
					</While>
				</If>
				<If Condition="Me.MapId == 646" > <!-- Deepholm -->
					<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;We're in Deepholm, using the portal for Orgrimmar.&quot;);" />
					<MoveTo Nav="Fly" X="991.8574" Y="458.2401" Z="-44.27066" />
					<While Condition="Me.MapId != 1" >
						<Code File="InteractWith" MobId="205273" X="990.495" Y="454.457" Z="-44.2477" TerminateWhen="Me.MapId == 1" />
						<Code File="WaitTimer" WaitTime="50000" TerminateWhen="Me.MapId == 1 || Me.Combat" />
					</While>
				</If>
				<If Condition="Me.MapId == 0" > <!-- Eastern Kingdoms -->
					<If Condition="Me.X &gt;= -5275 &amp;&amp; Me.MapId == 0" >
						<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;We're in Eastern Kingdoms, using the Undercity Zeppelin to Kalimdor.&quot;);" />
						<MoveTo Nav="Fly" X="2067.433" Y="286.6822" Z="97.03147" />
						<Code File="ForcedDismount" />
						<Code File="UseTransport" TransportId="164871"
							WaitAtX="2067.045" WaitAtY="290.4988" WaitAtZ="97.03147"
							TransportStartX="2062.376" TransportStartY="292.998" TransportStartZ="114.973" 
							StandOnX="2068.475" StandOnY="294.824" StandOnZ="97.26456"
							TransportEndX="1833.509" TransportEndY="-4391.543" TransportEndZ="152.7679"
							GetOffX="1840.091" GetOffY="-4392.189" GetOffZ="135.233" />
					</If>
					<If Condition="Me.X &lt; -5275 &amp;&amp; Me.MapId == 0" > <!-- Eastern Kingdoms to Draenor via Dark Portal -->
						<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;We're near the Dark Poral, using it to get to Draenor.&quot;);" />
						<MoveTo DestName="Dark Portal" Nav="Fly" X="-11885.52" Y="-3203.439" Z="0.6508498" />
						<Code File="MyCTM" X="-11907.09" Y="-3209.761" Z="-11.60053" TerminateWhen="Me.MapId != 0" />
						<Code File="WaitTimer" WaitTime="50000" TerminateWhen="Me.MapId != 0" />
					</If>
				</If>
				<If Condition="Me.MapId == 870" > <!-- Pandaria -->
					<Code File="RunCode" Code="DraenorLog(Colors.LightGreen, &quot;We're in Pandaria, using the Shrine portal to Orgrimmar.&quot;);" />
					<If Condition="Me.ZoneId != 6141" > <!-- If not inside of Shrine building -->
						<MoveTo Nav="Fly" X="1629.72" Y="924.5151" Z="471.1836" />
					</If>
					<MoveTo X="1734.699" Y="876.1328" Z="487.1131" />
					<While Condition="Me.MapId != 1" >
						<Code File="InteractWith" MobId="215127" X="1735.073" Y="873.5676" Z="487.4114" TerminateWhen="Me.MapId == 1" />
						<Code File="WaitTimer" WaitTime="50000" TerminateWhen="Me.MapId == 1 || Me.Combat" />
					</While>
				</If>
				<If Condition="Me.MapId == 1" > <!-- Northern Kaldimor, Orgrimmar to Grom'gol -->
					<If Condition="(!HasQuest(34398) &amp;&amp; !IsQuestCompleted(34398)) &amp;&amp; (!HasQuest(36881) &amp;&amp; !IsQuestCompleted(36881))" > <!-- Pick up Draenor Intro Quest -->
						<Code File="RunCode" Code="Bots.Professionbuddy.PBLog.Log(System.Windows.Media.Colors.DeepSkyBlue, &quot;[Azyul Navigator]: &quot;, System.Windows.Media.Colors.LightGreen, &quot;Picking up Draenor introductory quest.&quot;);" />
						<PickUp Nav="Fly" QuestName="The Dark Portal" QuestId="34398" GiverName="Warchiefs Command Board" GiverId="206109" X="1596.325" Y="-4365.863" Z="21.06839" />
					</If>
					<Code File="RunCode" Code="Bots.Professionbuddy.PBLog.Log(System.Windows.Media.Colors.DeepSkyBlue, &quot;[Azyul Navigator]: &quot;, System.Windows.Media.Colors.LightGreen, &quot;We're in Kalimdor, taking the Orgrimmar portal to Blasted Lands.&quot;);" />
					<MoveTo Nav="Fly" X="1898.532" Y="-4502.935" Z="31.96245" />
					<MoveTo Nav="Run" X="1770.391" Y="-4326.818" Z="-8.306942" />
					<Code File="InteractWith" MobId="235877" X="1767.899" Y="-4326.429" Z="-8.405741" TerminateWhen="Me.MapId == 0" />
					<Code File="WaitTimer" WaitTime="50000" TerminateWhen="Me.MapId == 0 || Me.Combat" />
				</If>
			</If>

			<If Condition="Me.MapId == 0 &amp;&amp; (HasQuest(34398) || HasQuest(36881))" > <!-- Stop at Khadgar for the Draenor Intro Quests -->
				<Code File="RunCode" Code="Bots.Professionbuddy.PBLog.Log(System.Windows.Media.Colors.DeepSkyBlue, &quot;[Azyul Navigator]: &quot;, System.Windows.Media.Colors.LightGreen, &quot;We're near the Dark Poral, interacting with Khadgar.&quot;);" />
				<DisableBehavior Name="Pull" />
				<MoveTo DestName="Dark Portal" Nav="Fly" X="-11773.5" Y="-3177.272" Z="-28.37646" />
				<EnableBehavior Name="Pull" />
				<Else> <!-- Go into Dark Portal if intro quests are already complete. -->
					<Code File="FlyTo" X="-11855.01" Y="-3203.732" Z="-0.9383372" /> <!-- Fly up above packs of mobs. -->
					<Code File="FlyTo" X="-11919.09" Y="-3209.106" Z="-14.2238" TerminateWhen="Me.MapId != 0" /> <!-- Enter Dark Portal. -->
					<Code File="RunCode" Code="Bots.Professionbuddy.PBLog.Log(System.Windows.Media.Colors.DeepSkyBlue, &quot;[Azyul Navigator]: &quot;, System.Windows.Media.Colors.LightGreen, &quot;We have reached Draenor!&quot;);" />
				</Else>
			</If>
		</If>

		<If Condition="!IsQuestCompleted(34446) &amp;&amp; Me.Class != WoWClass.DemonHunter" >
			<Code File="LoadProfile" ProfileName="Draenor\Tanaan Jungle (Draenor Intro).xml" />
		</If>

		<If Condition="LoremasterCheckpointCheck(93, 8671)" >
			<Code File="LoadProfile" ProfileName="Draenor\Frostfire Ridge.xml" />
		</If>
		<If Condition="LoremasterCheckpointCheck(95, 8924)" >
			<Code File="LoadProfile" ProfileName="Draenor\Gorgrond.xml" />
		</If>
		<If Condition="LoremasterCheckpointCheck(97, 8919)" >
			<Code File="LoadProfile" ProfileName="Draenor\Talador.xml" />
		</If>
		<If Condition="LoremasterCheckpointCheck(98, 8926)" >
			<Code File="LoadProfile" ProfileName="Draenor\Spires of Arak.xml" />
		</If>
		<If Condition="Lua.GetReturnVal&lt;uint&gt;(&quot;return GetAccountExpansionLevel();&quot;, 0) &gt;= 6 ? LoremasterCheckpointCheck(98, 8928) : LoremasterCheckpointCheck(100, 8928)" >
			<Code File="LoadProfile" ProfileName="Draenor\Nagrand.xml" />
		</If>

		<If Condition="Lua.GetReturnVal&lt;uint&gt;(&quot;return GetAccountExpansionLevel();&quot;, 0) &gt;= 6" >
			<Code File="LoadProfile" ProfileName="100-110 Autoloader.xml" />
		</If>

		<Code File="RunCode" Code="Bots.Professionbuddy.PBLog.Log(System.Windows.Media.Colors.Yellow, &quot;[Profile Notification]: &quot;, System.Windows.Media.Colors.LightGreen, &quot;It seems Legion is not unlocked on this account, stopping the bot!&quot;);" />

	</QuestOrder>
</HBProfile>